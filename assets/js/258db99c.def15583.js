"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[427],{3912:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"guides/systems","title":"Systems","description":"Systems contain the logic that operates on entities. AlloyECS provides a scheduler for organizing and running systems.","source":"@site/docs/guides/systems.md","sourceDirName":"guides","slug":"/guides/systems","permalink":"/AlloyECS/docs/guides/systems","draft":false,"unlisted":false,"editUrl":"https://github.com/LithHash/AlloyECS/edit/main/docs/guides/systems.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"defaultSidebar","previous":{"title":"Queries","permalink":"/AlloyECS/docs/guides/queries"},"next":{"title":"Relationships","permalink":"/AlloyECS/docs/guides/relationships"}}');var d=s(4848),t=s(8453);const l={sidebar_position:3},i="Systems",a={},o=[{value:"Creating Systems",id:"creating-systems",level:2},{value:"System Phases",id:"system-phases",level:2},{value:"Running Systems",id:"running-systems",level:2},{value:"Run All Systems",id:"run-all-systems",level:3},{value:"Run Specific Phase",id:"run-specific-phase",level:3},{value:"Using Step (Recommended)",id:"using-step-recommended",level:3},{value:"Managing Systems",id:"managing-systems",level:2},{value:"Enable/Disable",id:"enabledisable",level:3},{value:"Remove",id:"remove",level:3},{value:"System Dependencies",id:"system-dependencies",level:2},{value:"Practical Example",id:"practical-example",level:2},{value:"Tips",id:"tips",level:2},{value:"1. Keep Systems Focused",id:"1-keep-systems-focused",level:3},{value:"2. Use Phases Correctly",id:"2-use-phases-correctly",level:3},{value:"3. Disable When Not Needed",id:"3-disable-when-not-needed",level:3}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"systems",children:"Systems"})}),"\n",(0,d.jsx)(n.p,{children:"Systems contain the logic that operates on entities. AlloyECS provides a scheduler for organizing and running systems."}),"\n",(0,d.jsx)(n.h2,{id:"creating-systems",children:"Creating Systems"}),"\n",(0,d.jsxs)(n.p,{children:["Add systems with ",(0,d.jsx)(n.code,{children:"world:addSystem()"}),":"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-lua",children:'world:addSystem(\r\n    "Movement",           -- Unique name\r\n    "Update",             -- Phase\r\n    {                     -- Dependencies\r\n        reads = { Position, Velocity },\r\n        writes = { Position }\r\n    },\r\n    function(deltaTime)   -- Callback\r\n        for entityId, pos, vel in world:query(Position, Velocity) do\r\n            world:set(entityId, Position, pos + vel * deltaTime)\r\n        end\r\n    end\r\n)\n'})}),"\n",(0,d.jsx)(n.h2,{id:"system-phases",children:"System Phases"}),"\n",(0,d.jsx)(n.p,{children:"Systems run in phases, executed in order:"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Phase"}),(0,d.jsx)(n.th,{children:"Order"}),(0,d.jsx)(n.th,{children:"Typical Use"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"PreUpdate"})}),(0,d.jsx)(n.td,{children:"1st"}),(0,d.jsx)(n.td,{children:"Input processing, physics preparation"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"Update"})}),(0,d.jsx)(n.td,{children:"2nd"}),(0,d.jsx)(n.td,{children:"Main game logic"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"PostUpdate"})}),(0,d.jsx)(n.td,{children:"3rd"}),(0,d.jsx)(n.td,{children:"Cleanup, collision response"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"PreRender"})}),(0,d.jsx)(n.td,{children:"4th"}),(0,d.jsx)(n.td,{children:"Visual preparation"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"Render"})}),(0,d.jsx)(n.td,{children:"5th"}),(0,d.jsx)(n.td,{children:"Rendering, UI updates"})]})]})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-lua",children:'-- Input runs first\r\nworld:addSystem("Input", "PreUpdate", {}, function(dt)\r\n    -- Process player input\r\nend)\r\n\r\n-- Movement runs during update\r\nworld:addSystem("Movement", "Update", {\r\n    writes = { Position }\r\n}, function(dt)\r\n    -- Move entities\r\nend)\r\n\r\n-- Cleanup runs after\r\nworld:addSystem("DeathCleanup", "PostUpdate", {}, function(dt)\r\n    for entityId in world:query(Dead) do\r\n        world:destroy(entityId)\r\n    end\r\nend)\n'})}),"\n",(0,d.jsx)(n.h2,{id:"running-systems",children:"Running Systems"}),"\n",(0,d.jsx)(n.h3,{id:"run-all-systems",children:"Run All Systems"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-lua",children:"world:runSystems(deltaTime)\n"})}),"\n",(0,d.jsx)(n.h3,{id:"run-specific-phase",children:"Run Specific Phase"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-lua",children:'world:runPhase("Update", deltaTime)\n'})}),"\n",(0,d.jsx)(n.h3,{id:"using-step-recommended",children:"Using Step (Recommended)"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"step()"})," handles everything:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-lua",children:"RunService.Heartbeat:Connect(function(dt)\r\n    world:step(dt)  -- Flushes commands, runs systems, clears changes\r\nend)\n"})}),"\n",(0,d.jsx)(n.h2,{id:"managing-systems",children:"Managing Systems"}),"\n",(0,d.jsx)(n.h3,{id:"enabledisable",children:"Enable/Disable"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-lua",children:'-- Disable a system (doesn\'t remove it)\r\nworld:disableSystem("AI")\r\n\r\n-- Re-enable it\r\nworld:enableSystem("AI")\n'})}),"\n",(0,d.jsx)(n.h3,{id:"remove",children:"Remove"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-lua",children:'world:removeSystem("Movement")\n'})}),"\n",(0,d.jsx)(n.h2,{id:"system-dependencies",children:"System Dependencies"}),"\n",(0,d.jsx)(n.p,{children:"Declare what components a system reads and writes:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-lua",children:'world:addSystem("Movement", "Update", {\r\n    reads = { Position, Velocity },\r\n    writes = { Position }\r\n}, function(dt)\r\n    -- ...\r\nend)\n'})}),"\n",(0,d.jsx)(n.p,{children:"This helps with:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Documentation"}),"\n",(0,d.jsx)(n.li,{children:"Future parallelization"}),"\n",(0,d.jsx)(n.li,{children:"Debugging"}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"practical-example",children:"Practical Example"}),"\n",(0,d.jsx)(n.p,{children:"Here's a complete game loop with multiple systems:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-lua",children:'local AlloyECS = require(path.to.AlloyECS)\r\nlocal RunService = game:GetService("RunService")\r\n\r\n-- Create world\r\nlocal world = AlloyECS.createWorld({ trackChanges = true })\r\n\r\n-- Components\r\nlocal Position = world:component()\r\nlocal Velocity = world:component()\r\nlocal Health = world:component()\r\nlocal Dead = world:tag()\r\nlocal Player = world:tag()\r\n\r\n-- Input System\r\nworld:addSystem("Input", "PreUpdate", {\r\n    writes = { Velocity }\r\n}, function(dt)\r\n    for entityId, vel in world:query(Velocity):with(Player):iter() do\r\n        -- Read input and update velocity\r\n        local input = Vector3.new(0, 0, 0)\r\n        -- ... get input ...\r\n        world:set(entityId, Velocity, input * 50)\r\n    end\r\nend)\r\n\r\n-- Movement System\r\nworld:addSystem("Movement", "Update", {\r\n    reads = { Velocity },\r\n    writes = { Position }\r\n}, function(dt)\r\n    for entityId, pos, vel in world:query(Position, Velocity) do\r\n        world:set(entityId, Position, pos + vel * dt)\r\n    end\r\nend)\r\n\r\n-- Death System\r\nworld:addSystem("Death", "Update", {\r\n    reads = { Health },\r\n    writes = { Dead }\r\n}, function(dt)\r\n    for entityId, health in world:query(Health):without(Dead):iter() do\r\n        if health <= 0 then\r\n            world:add(entityId, Dead)\r\n        end\r\n    end\r\nend)\r\n\r\n-- Cleanup System\r\nworld:addSystem("Cleanup", "PostUpdate", {\r\n    reads = { Dead }\r\n}, function(dt)\r\n    for entityId in world:query(Dead) do\r\n        world:deferDestroy(entityId)\r\n    end\r\nend)\r\n\r\n-- Game Loop\r\nRunService.Heartbeat:Connect(function(dt)\r\n    world:step(dt)\r\nend)\n'})}),"\n",(0,d.jsx)(n.h2,{id:"tips",children:"Tips"}),"\n",(0,d.jsx)(n.h3,{id:"1-keep-systems-focused",children:"1. Keep Systems Focused"}),"\n",(0,d.jsx)(n.p,{children:"Each system should do one thing well:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-lua",children:'-- \u2705 Good - focused systems\r\nworld:addSystem("Movement", ...)\r\nworld:addSystem("Collision", ...)\r\nworld:addSystem("Damage", ...)\r\n\r\n-- \u274c Avoid - monolithic system\r\nworld:addSystem("Everything", ..., function(dt)\r\n    -- 500 lines of code\r\nend)\n'})}),"\n",(0,d.jsx)(n.h3,{id:"2-use-phases-correctly",children:"2. Use Phases Correctly"}),"\n",(0,d.jsx)(n.p,{children:'Don\'t put everything in "Update":'}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-lua",children:'-- \u2705 Good - proper phase usage\r\nworld:addSystem("Input", "PreUpdate", ...)\r\nworld:addSystem("Physics", "Update", ...)\r\nworld:addSystem("Render", "Render", ...)\n'})}),"\n",(0,d.jsx)(n.h3,{id:"3-disable-when-not-needed",children:"3. Disable When Not Needed"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-lua",children:'-- Disable AI during cutscenes\r\nlocal function startCutscene()\r\n    world:disableSystem("AI")\r\n    world:disableSystem("PlayerInput")\r\nend\r\n\r\nlocal function endCutscene()\r\n    world:enableSystem("AI")\r\n    world:enableSystem("PlayerInput")\r\nend\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>i});var r=s(6540);const d={},t=r.createContext(d);function l(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);