"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[387],{5529:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"guides/queries","title":"Queries","description":"Queries are the primary way to find and iterate over entities with specific components. AlloyECS provides a powerful, cached query system.","source":"@site/docs/guides/queries.md","sourceDirName":"guides","slug":"/guides/queries","permalink":"/AlloyECS/docs/guides/queries","draft":false,"unlisted":false,"editUrl":"https://github.com/lithh/AlloyECS/edit/main/docs/guides/queries.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"defaultSidebar","previous":{"title":"Components","permalink":"/AlloyECS/docs/guides/components"},"next":{"title":"Systems","permalink":"/AlloyECS/docs/guides/systems"}}');var t=r(4848),o=r(8453);const s={sidebar_position:2},d="Queries",l={},a=[{value:"Basic Queries",id:"basic-queries",level:2},{value:"Query Filters",id:"query-filters",level:2},{value:"With Filter",id:"with-filter",level:3},{value:"Without Filter",id:"without-filter",level:3},{value:"Combining Filters",id:"combining-filters",level:3},{value:"Query Caching",id:"query-caching",level:2},{value:"Reactive Queries",id:"reactive-queries",level:2},{value:"Query Performance Tips",id:"query-performance-tips",level:2},{value:"1. Query Order Matters",id:"1-query-order-matters",level:3},{value:"2. Use With for Tags",id:"2-use-with-for-tags",level:3},{value:"3. Cache Query Components",id:"3-cache-query-components",level:3},{value:"4. Avoid Modifying During Iteration",id:"4-avoid-modifying-during-iteration",level:3}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"queries",children:"Queries"})}),"\n",(0,t.jsx)(n.p,{children:"Queries are the primary way to find and iterate over entities with specific components. AlloyECS provides a powerful, cached query system."}),"\n",(0,t.jsx)(n.h2,{id:"basic-queries",children:"Basic Queries"}),"\n",(0,t.jsx)(n.p,{children:"Query for entities with specific components:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- Single component\r\nfor entityId, position in world:query(Position) do\r\n    print(entityId, position)\r\nend\r\n\r\n-- Multiple components\r\nfor entityId, pos, vel in world:query(Position, Velocity) do\r\n    world:set(entityId, Position, pos + vel * deltaTime)\r\nend\r\n\r\n-- Three components\r\nfor entityId, pos, vel, health in world:query(Position, Velocity, Health) do\r\n    -- ...\r\nend\n"})}),"\n",(0,t.jsx)(n.h2,{id:"query-filters",children:"Query Filters"}),"\n",(0,t.jsx)(n.p,{children:"Use filters to refine your queries:"}),"\n",(0,t.jsx)(n.h3,{id:"with-filter",children:"With Filter"}),"\n",(0,t.jsx)(n.p,{children:"Require components without retrieving their values:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- Entities with Position AND Player tag, but only return Position\r\nfor entityId, pos in world:query(Position):with(Player):iter() do\r\n    -- pos is returned\r\n    -- Player is required but not returned (it's a tag anyway)\r\nend\n"})}),"\n",(0,t.jsx)(n.h3,{id:"without-filter",children:"Without Filter"}),"\n",(0,t.jsx)(n.p,{children:"Exclude entities with certain components:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- Entities with Position but NOT Dead\r\nfor entityId, pos in world:query(Position):without(Dead):iter() do\r\n    -- Only living entities\r\nend\n"})}),"\n",(0,t.jsx)(n.h3,{id:"combining-filters",children:"Combining Filters"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"for entityId, pos, vel in world:query(Position, Velocity)\r\n    :with(Player)\r\n    :without(Dead, Stunned)\r\n    :iter() \r\ndo\r\n    -- Players with Position and Velocity\r\n    -- That are not Dead or Stunned\r\nend\n"})}),"\n",(0,t.jsxs)(n.admonition,{title:"Remember iter()",type:"caution",children:[(0,t.jsxs)(n.p,{children:["When using ",(0,t.jsx)(n.code,{children:":with()"})," or ",(0,t.jsx)(n.code,{children:":without()"}),", you must call ",(0,t.jsx)(n.code,{children:":iter()"})," at the end!"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- \u2705 Correct\r\nfor e, p in world:query(Position):with(Player):iter() do end\r\n\r\n-- \u274c Wrong - missing iter()\r\nfor e, p in world:query(Position):with(Player) do end\n"})})]}),"\n",(0,t.jsx)(n.h2,{id:"query-caching",children:"Query Caching"}),"\n",(0,t.jsx)(n.p,{children:"Queries are automatically cached for performance. When you run the same query multiple times, AlloyECS reuses the cached results."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- First call - builds and caches results\r\nfor entityId, pos in world:query(Position) do end\r\n\r\n-- Subsequent calls - uses cache (very fast!)\r\nfor entityId, pos in world:query(Position) do end\r\nfor entityId, pos in world:query(Position) do end\n"})}),"\n",(0,t.jsx)(n.p,{children:"The cache is automatically invalidated when:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Entities are created or destroyed"}),"\n",(0,t.jsx)(n.li,{children:"Components are added or removed"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"reactive-queries",children:"Reactive Queries"}),"\n",(0,t.jsxs)(n.p,{children:["With ",(0,t.jsx)(n.code,{children:"trackChanges = true"}),", you can query for changes:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'local world = AlloyECS.createWorld({ trackChanges = true })\r\n\r\n-- Entities that gained Position this frame\r\nfor _, entityId in world:added(Position) do\r\n    print("New position on:", entityId)\r\nend\r\n\r\n-- Entities that lost Position this frame\r\nfor _, entityId in world:removed(Position) do\r\n    print("Position removed from:", entityId)\r\nend\r\n\r\n-- Entities whose Position changed this frame\r\nfor _, entityId in world:changed(Position) do\r\n    print("Position changed on:", entityId)\r\nend\n'})}),"\n",(0,t.jsx)(n.admonition,{title:"Clear Changes",type:"warning",children:(0,t.jsxs)(n.p,{children:["Call ",(0,t.jsx)(n.code,{children:"world:clearChanges()"})," at the end of each frame, or use ",(0,t.jsx)(n.code,{children:"world:step()"})," which does this automatically."]})}),"\n",(0,t.jsx)(n.h2,{id:"query-performance-tips",children:"Query Performance Tips"}),"\n",(0,t.jsx)(n.h3,{id:"1-query-order-matters",children:"1. Query Order Matters"}),"\n",(0,t.jsx)(n.p,{children:"Put the rarest component first for better performance:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- \u2705 Better - Boss is rare\r\nfor e, pos in world:query(Boss, Position) do end\r\n\r\n-- \u274c Slower - Position is common\r\nfor e, pos in world:query(Position, Boss) do end\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-use-with-for-tags",children:"2. Use With for Tags"}),"\n",(0,t.jsxs)(n.p,{children:["When you don't need the value, use ",(0,t.jsx)(n.code,{children:":with()"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- \u2705 Better - Player value not unpacked\r\nfor e, pos in world:query(Position):with(Player):iter() do end\r\n\r\n-- \u274c Slower - Player value unpacked but unused\r\nfor e, pos, _ in world:query(Position, Player) do end\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-cache-query-components",children:"3. Cache Query Components"}),"\n",(0,t.jsx)(n.p,{children:"Don't rebuild component lists each frame:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- \u2705 Good - components defined once\r\nlocal Position, Velocity = world:component(), world:component()\r\n\r\nRunService.Heartbeat:Connect(function(dt)\r\n    for e, pos, vel in world:query(Position, Velocity) do\r\n        world:set(e, Position, pos + vel * dt)\r\n    end\r\nend)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-avoid-modifying-during-iteration",children:"4. Avoid Modifying During Iteration"}),"\n",(0,t.jsx)(n.p,{children:"Use deferred operations when modifying entities during queries:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- \u2705 Safe - deferred destruction\r\nfor entityId, health in world:query(Health) do\r\n    if health <= 0 then\r\n        world:deferDestroy(entityId)\r\n    end\r\nend\r\nworld:flush()\r\n\r\n-- \u274c Dangerous - modifying during iteration\r\nfor entityId, health in world:query(Health) do\r\n    if health <= 0 then\r\n        world:destroy(entityId) -- May cause issues!\r\n    end\r\nend\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>d});var i=r(6540);const t={},o=i.createContext(t);function s(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);